<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Suporte Simulator — Edição Corporativa v5.9</title>
  <style>
    :root {
      --bg: #0b1320;
      --card: #0f1b2b;
      --accent: #ff6b35;
      --muted: #9fb3c8;
      --correct: #4ade80;
      --wrong: #f87171;
      --neutral: #fbbf24;
      --special: #a855f7;
      --dev: #3b82f6;
      --manager: #f59e0b;
    }
    
    body {
      font-family: Inter, system-ui, Segoe UI, Arial;
      background: linear-gradient(180deg, #071021, #0b1320);
      color: #e6f0fb;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow: hidden;
    }
    
    .game-container {
      display: grid;
      grid-template-columns: 1fr 300px;
      height: 100vh;
    }
    
    .office-view {
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow: auto;
    }
    
    .hud {
      background: var(--card);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .player-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      border: 2px solid var(--accent);
      flex-shrink: 0;
      position: relative;
      cursor: pointer;
    }
    
    .hud-content {
      flex: 1;
    }
    
    .stats-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .day-info {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #071826;
      border-radius: 4px;
      margin: 8px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 4px;
      transition: width .3s;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    .control-btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background: var(--accent);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .control-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .control-btn.start {
      background: #10b981;
    }
    
    .control-btn.pause {
      background: #f59e0b;
    }
    
    .control-btn.reset {
      background: #ef4444;
    }
    
    .control-btn.speed {
      background: #8b5cf6;
    }
    
    .office-layout {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 15px;
      flex: 1;
    }
    
    .room {
      background: var(--card);
      border-radius: 10px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .room-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .room-title {
      font-weight: bold;
      font-size: 14px;
    }
    
    .desks-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      flex: 1;
    }
    
    .desk {
      width: 70px;
      height: 70px;
      background: #0a1a2a;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all 0.3s;
      font-size: 12px;
      text-align: center;
      padding: 5px;
      cursor: pointer;
    }
    
    .desk.player {
      border: 2px solid var(--accent);
      transform: scale(1.05);
    }
    
    .desk.busy {
      border: 2px solid var(--wrong);
    }
    
    .desk.available {
      border: 2px solid var(--correct);
    }
    
    .desk.dev {
      background: #1e3a5f;
      border: 2px solid var(--dev);
    }
    
    .desk.manager {
      background: #3a2a0f;
      border: 2px solid var(--manager);
    }
    
    .call-indicator {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
    }
    
    .phone-call {
      background: var(--accent);
    }
    
    .computer-call {
      background: var(--special);
    }
    
    .dev-task {
      background: var(--dev);
    }
    
    .dev-progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: #071826;
      border-radius: 0 0 8px 8px;
      overflow: hidden;
    }
    
    .dev-progress-fill {
      height: 100%;
      background: var(--dev);
      transition: width 0.3s;
      border-radius: 0 0 8px 8px;
    }
    
    .sidebar {
      background: var(--card);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
      border-left: 1px solid rgba(255,255,255,0.1);
    }
    
    .call-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .call-btn {
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: white;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      transition: all 0.2s;
      position: relative;
    }
    
    .call-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .call-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .call-btn.phone {
      background: #10b981;
    }
    
    .call-btn.computer {
      background: #8b5cf6;
    }
    
    .call-btn.transfer {
      background: #f59e0b;
    }
    
    .call-btn.dev {
      background: var(--dev);
    }
    
    .status-panel {
      background: #071826;
      padding: 15px;
      border-radius: 8px;
    }
    
    .last-call-rating {
      margin-top: 10px;
      padding: 8px;
      background: #082033;
      border-radius: 6px;
      font-size: 12px;
    }
    
    .rating-good {
      color: var(--correct);
    }
    
    .rating-bad {
      color: var(--wrong);
    }
    
    .rating-neutral {
      color: var(--neutral);
    }
    
    .log {
      background: #071b2a;
      padding: 12px;
      border-radius: 8px;
      height: 200px;
      overflow: auto;
      font-size: 13px;
      flex: 1;
    }
    
    .achievements {
      background: #071826;
      padding: 15px;
      border-radius: 8px;
    }
    
    .achievement-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }
    
    .achievement {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px;
      background: #082033;
      border-radius: 6px;
      font-size: 13px;
    }
    
    .achievement.unlocked {
      border-left: 4px solid var(--correct);
    }
    
    .achievement.locked {
      opacity: 0.6;
    }
    
    .achievement-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--neutral);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(2,6,12,.8);
      z-index: 1000;
    }
    
    .modal .box {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      min-width: 400px;
      max-width: 500px;
      border: 1px solid rgba(255,255,255,.1);
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }
    
    .opt {
      padding: 10px;
      border-radius: 8px;
      background: #082033;
      border: 1px solid rgba(255,255,255,.03);
      cursor: pointer;
      transition: all .2s;
    }
    
    .opt:hover {
      background: #0a2942;
      transform: translateY(-1px);
    }
    
    .lunch-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .lunch-opt {
      padding: 12px;
      border-radius: 8px;
      background: #082033;
      border: 1px solid rgba(255,255,255,.03);
      cursor: pointer;
      text-align: center;
      transition: all .2s;
    }
    
    .lunch-opt:hover {
      background: #0a2942;
    }
    
    .manager-event {
      text-align: center;
      padding: 15px;
      background: #1e3a5f;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    .manager-options {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }
    
    .manager-btn {
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .manager-btn:hover {
      transform: translateY(-2px);
    }
    
    .manager-btn.accept {
      background: var(--correct);
      color: #051018;
    }
    
    .manager-btn.decline {
      background: var(--wrong);
      color: white;
    }
    
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      z-index: 1000;
      max-width: 200px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .name-input-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(2,6,12,.8);
      z-index: 2000;
    }
    
    .name-input-container {
      background: var(--card);
      padding: 25px;
      border-radius: 10px;
      width: 500px;
      max-width: 90vw;
      border: 1px solid rgba(255,255,255,.1);
    }
    
    .name-input-section {
      margin-bottom: 20px;
    }
    
    .name-input-section h3 {
      margin-bottom: 10px;
      color: var(--accent);
    }
    
    .name-input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .name-input {
      padding: 8px 12px;
      border-radius: 6px;
      background: #082033;
      border: 1px solid rgba(255,255,255,.1);
      color: white;
      font-size: 14px;
    }
    
    .name-input:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .start-game-btn {
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: white;
      font-weight: bold;
      cursor: pointer;
      display: block;
      margin: 20px auto 0;
      transition: all 0.2s;
    }
    
    .start-game-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255,107,53,0.3);
    }
    
    /* NOVOS ESTILOS ADICIONADOS */
    .phone-background {
      background: linear-gradient(135deg, #1a3a5f, #0f1b2b);
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M30,20 L70,20 L70,80 L30,80 Z" fill="none" stroke="%23ff6b35" stroke-width="2"/><circle cx="50" cy="30" r="5" fill="%23ff6b35"/><rect x="40" y="45" width="20" height="30" rx="3" fill="%23ff6b35"/></svg>');
      background-repeat: no-repeat;
      background-position: center;
      background-size: 150px;
    }
    
    .chat-background {
      background: linear-gradient(135deg, #2d1b69, #0f1b2b);
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="10" y="20" width="80" height="60" rx="10" fill="%238b5cf6" opacity="0.3"/><rect x="20" y="30" width="60" height="10" rx="5" fill="%238b5cf6"/><rect x="20" y="50" width="40" height="10" rx="5" fill="%238b5cf6"/><rect x="70" y="70" width="15" height="15" rx="2" fill="%238b5cf6"/></svg>');
      background-repeat: no-repeat;
      background-position: center;
      background-size: 150px;
    }
    
    .analyst-help-modal {
      text-align: center;
    }
    
    .analyst-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      font-size: 40px;
    }
    
    .analyst-badge {
      background: var(--card);
      padding: 8px 15px;
      border-radius: 20px;
      display: inline-block;
      margin-top: 10px;
      border: 1px solid var(--accent);
    }
    
    .analyst-options {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .analyst-btn {
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .analyst-btn.help {
      background: var(--correct);
      color: #051018;
    }
    
    .analyst-btn.ignore {
      background: var(--wrong);
      color: white;
    }
    
    .conversation-modal {
      text-align: center;
    }
    
    .conversation-options {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .conversation-btn {
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .conversation-btn.talk {
      background: var(--correct);
      color: #051018;
    }
    
    .conversation-btn.ignore {
      background: var(--wrong);
      color: white;
    }
    
    .speed-controls {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }
    
    .speed-btn {
      padding: 5px 10px;
      border-radius: 4px;
      border: none;
      background: #082033;
      color: white;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }
    
    .speed-btn.active {
      background: var(--accent);
    }
    
    .speed-btn:hover {
      background: #0a2942;
    }
    
    .analyst-select-modal {
      text-align: center;
    }
    
    .analyst-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .analyst-item {
      padding: 12px;
      border-radius: 8px;
      background: #082033;
      border: 1px solid rgba(255,255,255,.1);
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .analyst-item:hover {
      background: #0a2942;
      transform: translateY(-2px);
    }
    
    .question-modal-content {
      position: relative;
      z-index: 1001;
    }
    
    .complaint-modal {
      text-align: center;
    }
    
    .complaint-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .complaint-item {
      padding: 12px;
      border-radius: 8px;
      background: #082033;
      border: 1px solid rgba(255,255,255,.1);
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .complaint-item:hover {
      background: #0a2942;
      transform: translateY(-2px);
    }
    
    .analyst-progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: #071826;
      border-radius: 0 0 8px 8px;
      overflow: hidden;
    }
    
    .analyst-progress-fill {
      height: 100%;
      background: var(--accent);
      transition: width 0.3s;
      border-radius: 0 0 8px 8px;
    }
  </style>
</head>
<body>
  <!-- Modal para inserir nomes antes do jogo -->
  <div class="name-input-modal" id="nameInputModal">
    <div class="name-input-container">
      <h2 style="text-align: center; margin-bottom: 20px;">Configurar Equipe</h2>
      
      <div class="name-input-section">
        <h3>Analistas</h3>
        <div class="name-input-grid">
          <input type="text" class="name-input" id="analystName1" placeholder="Analista 1" value="Gabi Fyre">
          <input type="text" class="name-input" id="analystName2" placeholder="Analista 2" value="Alysson Vex">
          <input type="text" class="name-input" id="analystName3" placeholder="Analista 3" value="Raf Teks">
          <input type="text" class="name-input" id="analystName4" placeholder="Analista 4" value="Cello M">
          <input type="text" class="name-input" id="analystName5" placeholder="Analista 5" value="J.V. Blaze">
          <input type="text" class="name-input" id="analystName6" placeholder="Analista 6" value="Leti Moon">
          <input type="text" class="name-input" id="analystName7" placeholder="Analista 7" value="Juli Amoré">
          <input type="text" class="name-input" id="analystName8" placeholder="Analista 8" value="Nando Flux">
          <input type="text" class="name-input" id="analystName9" placeholder="Analista 9" value="MarkZyn">
          <input type="text" class="name-input" id="analystName10" placeholder="Analista 10" value="Nathi Vega">
          <input type="text" class="name-input" id="analystName11" placeholder="Analista 11" value="MatZer0">
          <input type="text" class="name-input" id="analystName12" placeholder="Analista 12" value="Duda Kôshi">
        </div>
      </div>
      
      <div class="name-input-section">
        <h3>Desenvolvedores</h3>
        <div class="name-input-grid">
          <input type="text" class="name-input" id="devName1" placeholder="Desenvolvedor 1" value="L.F. Storm">
          <input type="text" class="name-input" id="devName2" placeholder="Desenvolvedor 2" value="L.H. Void">
          <input type="text" class="name-input" id="devName3" placeholder="Desenvolvedor 3" value="Rick.Mestre">
          <input type="text" class="name-input" id="devName4" placeholder="Desenvolvedor 4" value="Lukes">
        </div>
      </div>
      
      <div class="name-input-section">
        <h3>Gerentes</h3>
        <div class="name-input-grid">
          <input type="text" class="name-input" id="managerName1" placeholder="Gerente 1" value="Carlos Silva">
          <input type="text" class="name-input" id="managerName2" placeholder="Gerente 2" value="Ana Costa">
        </div>
      </div>
      
      <div class="name-input-section">
        <h3>Seu Nome</h3>
        <input type="text" class="name-input" id="playerName" placeholder="Seu nome" value="Você" style="width: 100%;">
      </div>
      
      <button class="start-game-btn" onclick="startGameWithNames()">Iniciar Jogo</button>
    </div>
  </div>

  <div class="game-container">
    <div class="office-view">
      <div class="hud">
        <!-- AVATAR DO JOGADOR ADICIONADO AQUI -->
        <div class="player-avatar" id="playerAvatar" onclick="showAnalystSelectModal()">👨‍💼</div>
        <div class="hud-content">
          <div class="stats-bar">
            <div><strong>Suporte Corporativo</strong></div>
            <div>Pontos: <span id="totalPoints">0</span></div>
            <div>Moral: <span id="moralLevel">Normal</span></div>
          </div>
          
          <div class="day-info">
            <div>Dia: <span id="day">1</span>/5</div>
            <div>Horário: <span id="time">08:00</span></div>
            <div>Chamadas: <span id="calls">0</span></div>
            <div>Meta: <span id="goalProgress">0/0</span></div>
          </div>
          
          <div class="progress-bar">
            <div class="progress-fill" id="dayProgress" style="width:0%"></div>
          </div>
          
          <div class="controls">
            <button class="control-btn start" id="startBtn">▶ Iniciar</button>
            <button class="control-btn pause" id="pauseBtn">⏸ Pausar</button>
            <button class="control-btn reset" id="resetBtn">⏹ Reiniciar</button>
            <div class="speed-controls">
              <button class="speed-btn active" id="speed1x" onclick="setGameSpeed(1)">1x</button>
              <button class="speed-btn" id="speed2x" onclick="setGameSpeed(2)">2x</button>
              <button class="speed-btn" id="speed5x" onclick="setGameSpeed(5)">5x</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="office-layout" id="officeLayout">
        <!-- Layout será gerado pelo JavaScript -->
      </div>
    </div>
    
    <div class="sidebar">
      <div class="call-controls">
        <h3>Controles de Chamada</h3>
        <button class="call-btn phone" id="answerPhoneBtn" disabled>
          📞 Atender Telefone
        </button>
        <button class="call-btn computer" id="answerComputerBtn" disabled>
          💻 Atender Computador
        </button>
        <button class="call-btn transfer" id="transferBtn" disabled>
          🔄 Transferir Chamada
        </button>
        <button class="call-btn dev" id="sendToDevBtn" disabled>
          ⚙️ Enviar para Desenvolvimento
        </button>
      </div>
      
      <div class="status-panel">
        <h3>Status do Analista</h3>
        <div id="analystStatus">Disponível</div>
        <div>Chamadas Atendidas: <span id="playerCalls">0</span></div>
        <div>Taxa de Acerto: <span id="accuracy">0%</span></div>
        <div>Pontuação: <span id="playerPoints">0</span></div>
        
        <div class="last-call-rating" id="lastCallRating" style="display: none;">
          <strong>Avaliação do último chamado:</strong>
          <div id="ratingText"></div>
        </div>
      </div>
      
      <div class="log" id="log">
        <!-- Log de eventos -->
      </div>
      
      <div class="achievements">
        <h3>Conquistas</h3>
        <div class="achievement-list" id="achievementList">
          <!-- Lista de conquistas -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para perguntas -->
  <div class="modal" id="questionModal">
    <div class="box question-modal-content">
      <div id="modalTitle"><strong id="callerType">Pergunta</strong></div>
      <div id="modalQuestion" style="margin-top:8px">...</div>
      <div class="options" id="modalOptions"></div>
    </div>
  </div>

  <!-- Modal para almoço -->
  <div class="modal" id="lunchModal">
    <div class="box">
      <h3>Hora do Almoço</h3>
      <p>O que você vai fazer durante o almoço?</p>
      <div class="lunch-options">
        <div class="lunch-opt" onclick="selectLunchOption('fofoca_boa')">
          Fazer fofoca positiva sobre colegas
        </div>
        <div class="lunch-opt" onclick="selectLunchOption('fofoca_ruim')">
          Fazer fofoca negativa sobre colegas
        </div>
        <div class="lunch-opt" onclick="selectLunchOption('trabalhar')">
          Trabalhar durante o almoço
        </div>
        <div class="lunch-opt" onclick="selectLunchOption('descansar')">
          Descansar sem falar com ninguém
        </div>
      </div>
    </div>
  </div>

  <!-- Modal do gerente -->
  <div class="modal" id="managerModal">
    <div class="box">
      <div class="manager-event">
        <h3>👨‍💼 Gerente</h3>
        <p id="managerMessage">Precisamos de você para fazer hora extra hoje. Você aceita?</p>
        <div class="manager-options">
          <button class="manager-btn accept" onclick="handleManagerRequest(true)">Aceitar</button>
          <button class="manager-btn decline" onclick="handleManagerRequest(false)">Recusar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para ajuda de analista -->
  <div class="modal" id="analystHelpModal">
    <div class="box analyst-help-modal">
      <div class="analyst-avatar">👨‍💻</div>
      <h3 id="analystHelpName">Analista</h3>
      <div class="analyst-badge" id="analystHelpBadge">Analista</div>
      <p id="analystHelpMessage">Preciso de ajuda com este problema complexo!</p>
      <div class="analyst-options">
        <button class="analyst-btn help" onclick="handleAnalystHelp(true)">Ajudar</button>
        <button class="analyst-btn ignore" onclick="handleAnalystHelp(false)">Ignorar</button>
      </div>
    </div>
  </div>

  <!-- Modal para conversa com analista -->
  <div class="modal" id="conversationModal">
    <div class="box conversation-modal">
      <div class="analyst-avatar">👨‍💻</div>
      <h3 id="conversationAnalystName">Analista</h3>
      <div class="analyst-badge" id="conversationAnalystBadge">Analista</div>
      <p id="conversationMessage">E aí, tudo bem? Quer bater um papo?</p>
      <div class="conversation-options">
        <button class="conversation-btn talk" onclick="handleConversation(true)">Conversar</button>
        <button class="conversation-btn ignore" onclick="handleConversation(false)">Ignorar</button>
      </div>
    </div>
  </div>

  <!-- Modal para selecionar analista para conversa -->
  <div class="modal" id="analystSelectModal">
    <div class="box analyst-select-modal">
      <h3>👥 Escolher Colega para Conversar</h3>
      <p>Selecione com quem você gostaria de bater papo:</p>
      <div class="analyst-list" id="analystList">
        <!-- Lista de analistas será preenchida aqui -->
      </div>
    </div>
  </div>

  <!-- Modal para ajudar analista com pergunta -->
  <div class="modal" id="analystQuestionModal">
    <div class="box question-modal-content">
      <div id="analystModalTitle"><strong>👨‍💻 Ajudando <span id="helpingAnalystName">Analista</span></strong></div>
      <div id="analystModalQuestion" style="margin-top:8px">...</div>
      <div class="options" id="analystModalOptions"></div>
    </div>
  </div>

  <!-- Modal para reclamar de analista -->
  <div class="modal" id="complaintModal">
    <div class="box complaint-modal">
      <h3>👨‍💼 Reclamação na Gerência</h3>
      <p>Selecione o analista sobre quem você quer reclamar:</p>
      <div class="complaint-list" id="complaintList">
        <!-- Lista de analistas para reclamar -->
      </div>
    </div>
  </div>

  <!-- Modal para fofoca dos bots -->
  <div class="modal" id="gossipModal">
    <div class="box">
      <div class="manager-event">
        <h3>⚠️ ATENÇÃO DA GERÊNCIA</h3>
        <p id="gossipMessage">Houve reclamações sobre seu comportamento. Vamos conversar?</p>
        <div class="manager-options">
          <button class="manager-btn accept" onclick="handleGossipComplaint(true)">Explicar</button>
          <button class="manager-btn decline" onclick="handleGossipComplaint(false)">Ignorar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para entrega de tarefa de desenvolvimento -->
  <div class="modal" id="devDeliveryModal">
    <div class="box">
      <div class="manager-event">
        <h3>⚙️ Tarefa Concluída</h3>
        <p id="devDeliveryMessage">A tarefa de desenvolvimento está pronta para entrega ao cliente!</p>
        <div class="manager-options">
          <button class="manager-btn accept" onclick="deliverDevTask()">Entregar ao Cliente</button>
        </div>
      </div>
    </div>
  </div>

  <audio id="ringSound" src="https://actions.google.com/sounds/v1/alarms/phone_alerts_and_rings.ogg" preload="auto"></audio>
  <audio id="correctSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" preload="auto"></audio>
  <audio id="wrongSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_fail_strings.ogg" preload="auto"></audio>

  <script>
    // CONFIGURAÇÕES DO JOGO - TEMPO REDUZIDO PARA 1 MINUTO
    const realDurationMinutes = 1;
    const totalSimHours = 10;
    const daysTotal = 5;
    const callRingRealTimeout = 10000;
    const answerResponseDeadline = 10000;

    // Sistema de perguntas
    const questions = [
      {q:'Meu sistema não está abrindo, o que faço?',correct:'Verifique o gerenciador token;',neutral:'Reinicie o computador;',wrong:'Chame um técnico de T.I;', type: 'simple'},
      {q:'Depois que você mexeu aqui, meu monitor não liga mais!.',correct:'Não tem relação com o que fiz,chame um técnico de T.i ;',neutral:'Reinicie o computador;',wrong:'Verifique o gerenciador token;', type: 'simple'},
      {q:'Meu Computador está pedindo para atualizar o Windows!',correct:'Reinicie o computador;',neutral:'Chame um técnico de T.i;',wrong:'Verifique o gerenciador token;', type: 'simple'},
      {q:'Esqueci minha senha, como proceder?',correct:'Solicitar redefinição pelo sistema;',neutral:'Contatar o administrador;',wrong:'Criar nova conta;', type: 'simple'},
      {q:'O sistema está muito lento hoje.',correct:'Verificar conexão de rede;',neutral:'Reiniciar o sistema;',wrong:'Comprar computador novo;', type: 'simple'},
      {q:'Não consigo imprimir documentos.',correct:'Verificar fila de impressão;',neutral:'Reiniciar impressora;',wrong:'Reinstalar Windows;', type: 'simple'},
      {q:'Perdi um arquivo importante!',correct:'Verificar lixeira e backup;',neutral:'Procurar em pastas recentes;',wrong:'Formatar computador;', type: 'simple'},
      {q:'O email não está sincronizando.',correct:'Verificar configurações IMAP;',neutral:'Reiniciar cliente email;',wrong:'Criar nova conta email;', type: 'simple'},
      // Novas perguntas de erro de sistema (para desenvolvimento)
      {q:'O sistema está apresentando erro 500 em todas as requisições.',correct:'Verificar logs do servidor;',neutral:'Reiniciar o servidor;',wrong:'Reinstalar o sistema;', type: 'system'},
      {q:'O banco de dados não está respondendo às consultas.',correct:'Verificar conexão com o banco;',neutral:'Reiniciar serviço de banco;',wrong:'Formatar servidor;', type: 'system'},
      {q:'Há um vazamento de memória no sistema após a última atualização.',correct:'Analisar código da atualização;',neutral:'Reiniciar servidor periodicamente;',wrong:'Ignorar o problema;', type: 'system'},
      {q:'As transações financeiras estão duplicando no sistema.',correct:'Auditar código de transações;',neutral:'Desfazer transações manualmente;',wrong:'Continuar operação normal;', type: 'system'},
      {q:'O sistema de autenticação está rejeitando usuários válidos.',correct:'Verificar configurações de LDAP;',neutral:'Resetar senhas manualmente;',wrong:'Criar novas contas para todos;', type: 'system'},
      {q:'O relatório mensal está gerando dados inconsistentes.',correct:'Auditar queries do relatório;',neutral:'Gerar relatório manualmente;',wrong:'Alterar dados manualmente;', type: 'system'},
      {q:'A integração com o sistema de pagamento está falhando.',correct:'Verificar API de pagamento;',neutral:'Processar pagamentos manualmente;',wrong:'Desativar sistema de pagamento;', type: 'system'}
    ];

    // Sistema de desenvolvimento
    const devTasks = [
      { name: "Correção de bug simples", duration: 10000, points: 100 },
      { name: "Correção de bug complexo", duration: 15000, points: 200 },
      { name: "Nova funcionalidade", duration: 20000, points: 300 },
      { name: "Otimização de sistema", duration: 12000, points: 150 }
    ];

    // Sistema de conquistas
    const achievements = [
      { id: "first_call", name: "Primeira Chamada", description: "Atenda sua primeira chamada", unlocked: false },
      { id: "five_calls", name: "Atendimento Rápido", description: "Atenda 5 chamadas em um dia", unlocked: false },
      { id: "perfect_day", name: "Dia Perfeito", description: "Acerte todas as chamadas em um dia", unlocked: false },
      { id: "dev_master", name: "Mestre do Desenvolvimento", description: "Complete 5 tarefas de desenvolvimento", unlocked: false },
      { id: "transfer_pro", name: "Profissional de Transferência", description: "Transfira 10 chamadas", unlocked: false },
      { id: "overtime_king", name: "Rei da Hora Extra", description: "Aceite hora extra 3 vezes", unlocked: false },
      { id: "lunch_gossip", name: "Fofoqueiro do Almoço", description: "Faça fofoca em todos os almoços", unlocked: false }
    ];

    // Estado do jogo
    let gameState = {
      day: 1,
      time: "08:00",
      running: false,
      simMsPerMin: 0,
      simStartReal: 0,
      simTimer: null,
      attended: 0,
      gameSpeed: 1,
      player: {
        name: "Você",
        points: 0,
        callsAttended: 0,
        correctAnswers: 0,
        transfers: 0,
        devTasks: 0,
        overtimeAccepted: 0
      },
      calls: {
        active: 0,
        total: 0,
        goal: 0,
        answered: 0
      },
      desks: [],
      analysts: [],
      developers: [],
      managers: [],
      currentCall: null,
      callTimer: null,
      lastRating: null,
      moral: 50,
      lunchSelected: false,
      lunchActive: false,
      managerEventShown: false,
      analystHelpActive: false,
      conversationActive: false,
      dailyCalls: 0,
      currentAnalystHelp: null,
      pendingDevTasks: [],
      gossipComplaintActive: false,
      transferredCalls: new Map(),
      // NOVOS ESTADOS ADICIONADOS
      callPerformance: {
        attended: 0,
        transferred: 0,
        lastCheck: 0
      },
      dayStartReal: 0,
      // NOVO: Controlar o tempo decorrido manualmente
      elapsedSimMinutes: 0
    };

    // Inicialização do jogo
    function initGame() {
      // Inicializar layout do escritório
      const officeLayout = document.getElementById('officeLayout');
      officeLayout.innerHTML = '';
      
      // Criar nomes
      const analystNames = [];
      for (let i = 1; i <= 12; i++) {
        const nameInput = document.getElementById(`analystName${i}`);
        analystNames.push(nameInput ? nameInput.value : `Analista ${i}`);
      }
      
      const devNames = [];
      for (let i = 1; i <= 4; i++) {
        const nameInput = document.getElementById(`devName${i}`);
        devNames.push(nameInput ? nameInput.value : `Dev ${i}`);
      }
      
      const managerNames = [];
      for (let i = 1; i <= 2; i++) {
        const nameInput = document.getElementById(`managerName${i}`);
        managerNames.push(nameInput ? nameInput.value : `Gerente ${i}`);
      }
      
      // Definir nome do jogador
      const playerNameInput = document.getElementById('playerName');
      if (playerNameInput) {
        gameState.player.name = playerNameInput.value;
        document.getElementById('playerAvatar').innerHTML = '👨‍💼<div style="font-size:10px;margin-top:2px;">' + gameState.player.name + '</div>';
      }
      
      // SALA DE SUPORTE
      const supportRoom = document.createElement('div');
      supportRoom.className = 'room';
      supportRoom.innerHTML = `
        <div class="room-header">
          <span>🛠️</span>
          <div class="room-title">Sala de Suporte</div>
        </div>
        <div class="desks-grid" id="supportDesks">
          <!-- Mesas de suporte serão adicionadas aqui -->
        </div>
      `;
      
      // SALA DE DESENVOLVIMENTO
      const devRoom = document.createElement('div');
      devRoom.className = 'room';
      devRoom.innerHTML = `
        <div class="room-header">
          <span>⚙️</span>
          <div class="room-title">Sala de Desenvolvimento</div>
        </div>
        <div class="desks-grid" id="devDesks">
          <!-- Mesas de desenvolvimento serão adicionadas aqui -->
        </div>
      `;
      
      // SALA DE GERÊNCIA
      const managerRoom = document.createElement('div');
      managerRoom.className = 'room';
      managerRoom.innerHTML = `
        <div class="room-header">
          <span>👔</span>
          <div class="room-title">Sala de Gerência</div>
        </div>
        <div class="desks-grid" id="managerDesks">
          <!-- Mesas de gerência serão adicionadas aqui -->
        </div>
      `;
      
      officeLayout.appendChild(supportRoom);
      officeLayout.appendChild(devRoom);
      officeLayout.appendChild(managerRoom);
      
      // Resetar estado
      gameState.desks = [];
      gameState.analysts = [];
      gameState.developers = [];
      gameState.managers = [];
      gameState.transferredCalls.clear();
      gameState.callPerformance.attended = 0;
      gameState.callPerformance.transferred = 0;
      gameState.elapsedSimMinutes = 0; // Resetar tempo decorrido
      
      // Adicionar jogador à sala de suporte
      const supportDesks = document.getElementById('supportDesks');
      const playerDesk = document.createElement('div');
      playerDesk.className = 'desk player';
      playerDesk.id = 'player-desk';
      playerDesk.innerHTML = `
        <div>👨‍💼</div>
        <div style="font-size:10px">${gameState.player.name}</div>
      `;
      supportDesks.appendChild(playerDesk);
      
      const playerDeskObj = {
        id: 'player-desk',
        name: gameState.player.name,
        type: 'player',
        busy: false,
        currentTask: null
      };
      gameState.desks.push(playerDeskObj);
      gameState.playerDesk = playerDeskObj;
      
      // Adicionar analistas à sala de suporte
      analystNames.forEach((name, index) => {
        const desk = document.createElement('div');
        const deskId = `analyst-desk-${index}`;
        desk.className = 'desk';
        desk.id = deskId;
        desk.innerHTML = `
          <div>👨‍💻</div>
          <div style="font-size:9px">${name}</div>
        `;
        desk.onclick = () => startConversation({name: name, id: deskId});
        supportDesks.appendChild(desk);
        
        const deskObj = {
          id: deskId,
          name: name,
          type: 'analyst',
          busy: false,
          currentTask: null
        };
        
        gameState.desks.push(deskObj);
        gameState.analysts.push(deskObj);
        
        // Adicionar tooltip
        addTooltipToDesk(desk, deskObj);
      });
      
      // Adicionar desenvolvedores à sala de desenvolvimento
      const devDesksElement = document.getElementById('devDesks');
      devNames.forEach((name, index) => {
        const desk = document.createElement('div');
        const deskId = `dev-desk-${index}`;
        desk.className = 'desk dev';
        desk.id = deskId;
        desk.innerHTML = `
          <div>👨‍💻</div>
          <div style="font-size:9px">${name}</div>
        `;
        desk.onclick = () => pressureDeveloper(deskId);
        devDesksElement.appendChild(desk);
        
        const deskObj = {
          id: deskId,
          name: name,
          type: 'dev',
          busy: false,
          currentTask: null,
          progressInterval: null
        };
        
        gameState.desks.push(deskObj);
        gameState.developers.push(deskObj);
        
        // Adicionar tooltip
        addTooltipToDesk(desk, deskObj);
      });
      
      // Adicionar gerentes à sala de gerência
      const managerDesksElement = document.getElementById('managerDesks');
      managerNames.forEach((name, index) => {
        const desk = document.createElement('div');
        const deskId = `manager-desk-${index}`;
        desk.className = 'desk manager';
        desk.id = deskId;
        desk.innerHTML = `
          <div>👔</div>
          <div style="font-size:9px">${name}</div>
        `;
        desk.onclick = () => showComplaintModal();
        managerDesksElement.appendChild(desk);
        
        const deskObj = {
          id: deskId,
          name: name,
          type: 'manager',
          busy: false,
          currentTask: null
        };
        
        gameState.desks.push(deskObj);
        gameState.managers.push(deskObj);
        
        // Adicionar tooltip
        addTooltipToDesk(desk, deskObj);
      });
      
      // Configurar metas de chamadas
      gameState.calls.goal = 5 + (gameState.day - 1) * 2;
      updateGoalDisplay();
      
      // Atualizar interface
      updateHUD();
      updateAchievements();
      
      // Adicionar event listeners
      document.getElementById('startBtn').addEventListener('click', startGame);
      document.getElementById('pauseBtn').addEventListener('click', pauseGame);
      document.getElementById('resetBtn').addEventListener('click', resetGame);
      
      document.getElementById('answerPhoneBtn').addEventListener('click', answerPhoneCall);
      document.getElementById('answerComputerBtn').addEventListener('click', answerComputerCall);
      document.getElementById('transferBtn').addEventListener('click', transferCall);
      document.getElementById('sendToDevBtn').addEventListener('click', sendToDevelopment);
      
      // Esconder modal de entrada de nomes
      document.getElementById('nameInputModal').style.display = 'none';
      
      // Adicionar log inicial
      addToLog("Sistema iniciado. Aguardando chamadas...");
    }

    // Adicionar tooltip às mesas
    function addTooltipToDesk(deskElement, deskData) {
      deskElement.addEventListener('mouseover', (e) => {
        showTooltip(e, generateTooltipText(deskData));
      });
      
      deskElement.addEventListener('mouseout', hideTooltip);
      deskElement.addEventListener('mousemove', (e) => {
        updateTooltipPosition(e);
      });
    }

    // Gerar texto do tooltip
    function generateTooltipText(deskData) {
      let text = `<strong>${deskData.name}</strong><br>`;
      
      if (deskData.type === 'player') {
        text += `Tipo: Jogador<br>`;
      } else if (deskData.type === 'analyst') {
        text += `Tipo: Analista<br>`;
      } else if (deskData.type === 'dev') {
        text += `Tipo: Desenvolvedor<br>`;
      } else if (deskData.type === 'manager') {
        text += `Tipo: Gerente<br>`;
      }
      
      text += `Status: ${deskData.busy ? 'Ocupado' : 'Disponível'}<br>`;
      
      if (deskData.busy && deskData.currentTask) {
        if (deskData.currentTask.type === 'call') {
          text += `Chamada: ${deskData.currentTask.question.q.substring(0, 30)}...<br>`;
          text += `Tipo: ${deskData.currentTask.callType === 'phone' ? 'Telefone' : 'Computador'}`;
        } else if (deskData.currentTask.type === 'dev') {
          text += `Tarefa: ${deskData.currentTask.name}<br>`;
          text += `Progresso: ${Math.round(deskData.currentTask.progress || 0)}%`;
        }
      }
      
      return text;
    }

    // Mostrar tooltip
    function showTooltip(event, text) {
      hideTooltip();
      
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip';
      tooltip.innerHTML = text;
      document.body.appendChild(tooltip);
      
      updateTooltipPosition(event);
      tooltip.style.opacity = '1';
      
      event.target.tooltip = tooltip;
    }

    // Atualizar posição do tooltip
    function updateTooltipPosition(event) {
      const tooltip = document.querySelector('.tooltip');
      if (tooltip) {
        const x = event.clientX + 15;
        const y = event.clientY + 15;
        tooltip.style.left = `${x}px`;
        tooltip.style.top = `${y}px`;
      }
    }

    // Esconder tooltip
    function hideTooltip() {
      const tooltip = document.querySelector('.tooltip');
      if (tooltip) {
        tooltip.remove();
      }
    }

    // Iniciar jogo com nomes personalizados
    function startGameWithNames() {
      initGame();
      startGame();
    }

    // Atualizar HUD
    function updateHUD() {
      document.getElementById('day').textContent = gameState.day;
      document.getElementById('time').textContent = gameState.time;
      document.getElementById('calls').textContent = gameState.calls.answered;
      document.getElementById('totalPoints').textContent = gameState.player.points;
      document.getElementById('playerCalls').textContent = gameState.player.callsAttended;
      document.getElementById('playerPoints').textContent = gameState.player.points;
      
      const accuracy = gameState.player.callsAttended > 0 
        ? Math.round((gameState.player.correctAnswers / gameState.player.callsAttended) * 100) 
        : 0;
      document.getElementById('accuracy').textContent = `${accuracy}%`;
      
      // Atualizar barra de progresso do dia
      const timeParts = gameState.time.split(':');
      const hours = parseInt(timeParts[0]);
      const minutes = parseInt(timeParts[1]);
      const totalMinutes = hours * 60 + minutes;
      const startMinutes = 8 * 60; // 08:00
      const endMinutes = 18 * 60; // 18:00
      const progress = Math.min(100, Math.max(0, ((totalMinutes - startMinutes) / (endMinutes - startMinutes)) * 100));
      
      document.getElementById('dayProgress').style.width = `${progress}%`;
      
      // Atualizar status de moral
      let moralLevel = "Normal";
      if (gameState.moral >= 70) moralLevel = "Alta";
      else if (gameState.moral >= 30) moralLevel = "Normal";
      else moralLevel = "Baixa";
      
      document.getElementById('moralLevel').textContent = moralLevel;
      
      // Atualizar avatar do jogador
      const playerAvatar = document.getElementById('playerAvatar');
      if (gameState.currentCall) {
        playerAvatar.style.background = gameState.currentCall.type === 'phone' ? '#10b981' : '#8b5cf6';
        playerAvatar.innerHTML = gameState.currentCall.type === 'phone' ? '📞' : '💻';
      } else {
        playerAvatar.style.background = 'var(--accent)';
        playerAvatar.innerHTML = '👨‍💼<div style="font-size:10px;margin-top:2px;">' + gameState.player.name + '</div>';
      }
      
      // Atualizar status do analista
      document.getElementById('analystStatus').textContent = gameState.currentCall ? 'Ocupado' : 'Disponível';
    }

    // Atualizar meta de chamadas
    function updateGoalDisplay() {
      document.getElementById('goalProgress').textContent = `${gameState.calls.answered}/${gameState.calls.goal}`;
    }

    // Definir velocidade do jogo
    function setGameSpeed(speed) {
      gameState.gameSpeed = speed;
      
      // Atualizar botões de velocidade
      document.getElementById('speed1x').classList.toggle('active', speed === 1);
      document.getElementById('speed2x').classList.toggle('active', speed === 2);
      document.getElementById('speed5x').classList.toggle('active', speed === 5);
      
      // Reiniciar temporizadores com nova velocidade
      if (gameState.running) {
        clearInterval(gameState.simTimer);
        gameState.simTimer = setInterval(updateSimulation, 1000 / gameState.gameSpeed);
      }
      
      addToLog(`Velocidade do jogo alterada para ${speed}x`);
    }

    // Iniciar jogo
    function startGame() {
      if (gameState.running) return;
      
      gameState.running = true;
      gameState.dayStartReal = Date.now();
      gameState.simStartReal = Date.now();
      gameState.simMsPerMin = (realDurationMinutes * 60 * 1000) / (totalSimHours * 60);
      
      // Iniciar temporizador de simulação
      gameState.simTimer = setInterval(updateSimulation, 1000 / gameState.gameSpeed);
      
      // Iniciar geração de chamadas
      startCallGeneration();
      
      // Iniciar transferências de bots
      startBotTransfers();
      
      // Iniciar sistema de fofoca
      startGossipSystem();
      
      // Iniciar sistema de monitoramento de desempenho
      startPerformanceMonitoring();
      
      // Atualizar interface
      document.getElementById('startBtn').disabled = true;
      document.getElementById('pauseBtn').disabled = false;
      
      addToLog("Jogo iniciado. Bom trabalho!");
    }

    // Pausar jogo
    function pauseGame() {
      if (!gameState.running) return;
      
      gameState.running = false;
      clearInterval(gameState.simTimer);
      if (gameState.callTimer) clearTimeout(gameState.callTimer);
      
      // Atualizar interface
      document.getElementById('startBtn').disabled = false;
      document.getElementById('pauseBtn').disabled = true;
      
      addToLog("Jogo pausado.");
    }

    // Reiniciar jogo
    function resetGame() {
      pauseGame();
      
      // Resetar estado do jogo
      gameState.day = 1;
      gameState.time = "08:00";
      gameState.attended = 0;
      gameState.gameSpeed = 1;
      gameState.player.points = 0;
      gameState.player.callsAttended = 0;
      gameState.player.correctAnswers = 0;
      gameState.player.transfers = 0;
      gameState.player.devTasks = 0;
      gameState.player.overtimeAccepted = 0;
      gameState.calls.active = 0;
      gameState.calls.total = 0;
      gameState.calls.answered = 0;
      gameState.calls.goal = 5;
      gameState.moral = 50;
      gameState.lunchSelected = false;
      gameState.lunchActive = false;
      gameState.managerEventShown = false;
      gameState.analystHelpActive = false;
      gameState.conversationActive = false;
      gameState.dailyCalls = 0;
      gameState.currentAnalystHelp = null;
      gameState.pendingDevTasks = [];
      gameState.gossipComplaintActive = false;
      gameState.transferredCalls.clear();
      gameState.callPerformance.attended = 0;
      gameState.callPerformance.transferred = 0;
      gameState.elapsedSimMinutes = 0; // Resetar tempo decorrido
      
      // Resetar conquistas
      achievements.forEach(ach => ach.unlocked = false);
      
      // Resetar interface
      updateHUD();
      updateGoalDisplay();
      updateAchievements();
      
      // Limpar log
      document.getElementById('log').innerHTML = '';
      
      // Desabilitar botões de chamada
      document.getElementById('answerPhoneBtn').disabled = true;
      document.getElementById('answerComputerBtn').disabled = true;
      document.getElementById('transferBtn').disabled = true;
      document.getElementById('sendToDevBtn').disabled = true;
      
      // Resetar botões de velocidade
      document.getElementById('speed1x').classList.add('active');
      document.getElementById('speed2x').classList.remove('active');
      document.getElementById('speed5x').classList.remove('active');
      
      // Esconder rating da última chamada
      document.getElementById('lastCallRating').style.display = 'none';
      
      addToLog("Jogo reiniciado. Preparado para começar!");
    }

    // Atualizar simulação - SISTEMA CORRIGIDO
    function updateSimulation() {
      if (!gameState.running) return;
      
      const now = Date.now();
      const elapsedRealMs = now - gameState.simStartReal;
      
      // Atualizar tempo decorrido manualmente para evitar problemas de precisão
      gameState.elapsedSimMinutes += (1000 / gameState.gameSpeed) / gameState.simMsPerMin;
      
      // Atualizar horário baseado no tempo decorrido
      const startHour = 8; // 08:00
      const totalMinutes = gameState.elapsedSimMinutes;
      const currentHour = startHour + Math.floor(totalMinutes / 60);
      const currentMinute = Math.floor(totalMinutes % 60);
      
      gameState.time = `${currentHour.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;
      
      // CORREÇÃO 1: Verificar se é hora do almoço (12:00) - INICIAR ALMOÇO
      if (currentHour === 12 && currentMinute === 0 && !gameState.lunchSelected && !gameState.lunchActive) {
        startLunchBreak();
        return; // Pausar a simulação até o almoço terminar
      }
      
      // CORREÇÃO 2: Verificar se é fim do expediente (18:00) - HORA EXTRA ATÉ 19:00
      if (currentHour === 18 && currentMinute === 0 && !gameState.managerEventShown) {
        // Verificar se o jogador está com desempenho baixo
        if (shouldShowManagerWarning()) {
          showManagerWarning();
        } else if (Math.random() < 0.7) {
          showManagerModal();
        } else {
          endDay();
        }
        gameState.managerEventShown = true;
        return;
      }
      
      // Verificar fim da hora extra (19:00)
      if (currentHour === 19 && currentMinute === 0) {
        endDay();
        return;
      }
      
      // Verificar se deve mostrar evento de analista pedindo ajuda
      if (!gameState.analystHelpActive && Math.random() < 0.02 && !gameState.lunchActive) {
        showAnalystHelpModal();
      }
      
      // Atualizar HUD
      updateHUD();
    }

    // CORREÇÃO 1: Iniciar pausa para almoço
    function startLunchBreak() {
      gameState.lunchActive = true;
      pauseGame();
      
      // Cancelar qualquer chamada atual
      if (gameState.currentCall) {
        gameState.currentCall = null;
        document.getElementById('answerPhoneBtn').disabled = true;
        document.getElementById('answerComputerBtn').disabled = true;
        document.getElementById('transferBtn').disabled = true;
        document.getElementById('sendToDevBtn').disabled = true;
      }
      
      // Parar som de chamada se estiver tocando
      document.getElementById('ringSound').pause();
      document.getElementById('ringSound').currentTime = 0;
      
      addToLog("🍽️ Hora do almoço! Escolha o que fazer...");
      document.getElementById('lunchModal').style.display = 'flex';
    }

    // CORREÇÃO 1: Selecionar opção de almoço (AGORA PULA CORRETAMENTE PARA 13:00)
    function selectLunchOption(option) {
      document.getElementById('lunchModal').style.display = 'none';
      
      let message = "";
      let moralChange = 0;
      
      switch(option) {
        case 'fofoca_boa':
          message = "Você fez fofoca positiva sobre colegas. Moral aumentada!";
          moralChange = 10;
          break;
        case 'fofoca_ruim':
          message = "Você fez fofoca negativa sobre colegas. Moral diminuída!";
          moralChange = -10;
          break;
        case 'trabalhar':
          message = "Você trabalhou durante o almoço. Ganhou pontos extras!";
          gameState.player.points += 50;
          moralChange = -5;
          break;
        case 'descansar':
          message = "Você descansou durante o almoço. Moral levemente aumentada.";
          moralChange = 5;
          break;
      }
      
      // Atualizar moral
      gameState.moral = Math.max(0, Math.min(100, gameState.moral + moralChange));
      gameState.lunchSelected = true;
      gameState.lunchActive = false;
      
      // CORREÇÃO CRÍTICA: Pular para 13:00 corretamente
      // 13:00 = 5 horas após 08:00 (8->13 = 5 horas)
      // 5 horas = 300 minutos
      gameState.elapsedSimMinutes = 300; // Define diretamente para 13:00
      
      // Adicionar ao log
      addToLog(`🍽️ ${message}`);
      addToLog("⏰ Volta do almoço! Hora de trabalhar.");
      
      // Atualizar interface
      updateHUD();
      
      // Reiniciar o jogo
      startGame();
      
      // Verificar conquistas
      if (option === 'fofoca_boa' || option === 'fofoca_ruim') {
        const gossipAchievement = achievements.find(a => a.id === 'lunch_gossip');
        if (gossipAchievement && !gossipAchievement.unlocked) {
          gossipAchievement.unlocked = true;
          addToLog("🏆 Conquista desbloqueada: Fofoqueiro do Almoço!");
          updateAchievements();
        }
      }
    }

    // CORREÇÃO 4: Verificar se deve mostrar advertência do gerente
    function shouldShowManagerWarning() {
      const totalActions = gameState.callPerformance.attended + gameState.callPerformance.transferred;
      if (totalActions === 0) return false;
      
      const transferRate = gameState.callPerformance.transferred / totalActions;
      const lowAttendance = gameState.callPerformance.attended < 3;
      
      return transferRate > 0.6 || lowAttendance;
    }

    // CORREÇÃO 4: Mostrar advertência do gerente
    function showManagerWarning() {
      gameState.managerEventShown = true;
      
      const totalActions = gameState.callPerformance.attended + gameState.callPerformance.transferred;
      const transferRate = gameState.callPerformance.transferred / totalActions;
      const lowAttendance = gameState.callPerformance.attended < 3;
      
      let message = "";
      if (transferRate > 0.6 && lowAttendance) {
        message = "Você está transferindo muitas chamadas e atendendo muito pouco! Isso não pode continuar.";
      } else if (transferRate > 0.6) {
        message = "Você está transferindo muitas chamadas. Precisamos conversar sobre seu desempenho.";
      } else {
        message = "Você está atendendo muito poucas chamadas. Precisamos melhorar isso.";
      }
      
      document.getElementById('managerMessage').textContent = message;
      document.getElementById('managerModal').style.display = 'flex';
      
      // Penalidade por desempenho ruim
      gameState.player.points -= 50;
      gameState.moral = Math.max(0, gameState.moral - 20);
      
      addToLog("⚠️ ADVERTÊNCIA: Gerente chamou atenção sobre seu desempenho! -50 pontos");
    }

    // Iniciar monitoramento de desempenho
    function startPerformanceMonitoring() {
      setInterval(() => {
        if (!gameState.running || gameState.lunchActive) return;
        
        // Atualizar contadores de desempenho a cada 30 segundos do jogo
        gameState.callPerformance.lastCheck = Date.now();
      }, 30000 / gameState.gameSpeed);
    }

    // ... (restante das funções permanecem iguais) ...

    // Iniciar geração de chamadas
    function startCallGeneration() {
      generateCall();
    }

    // Gerar chamada
    function generateCall() {
      if (!gameState.running || gameState.lunchActive) return;
      
      // Aumentar número de chamadas gradativamente a cada dia
      const baseCallRate = 30000; // 30 segundos
      const dayMultiplier = 1 + (gameState.day - 1) * 0.2; // Aumenta 20% por dia
      const speedMultiplier = gameState.gameSpeed;
      const nextCallDelay = baseCallRate / dayMultiplier / speedMultiplier;
      
      gameState.callTimer = setTimeout(() => {
        if (!gameState.running || gameState.lunchActive) return;
        
        // Verificar se o jogador está disponível
        if (!gameState.currentCall) {
          // Determinar tipo de chamada (telefone ou computador)
          const callType = Math.random() < 0.5 ? 'phone' : 'computer';
          
          // Selecionar pergunta aleatória
          const question = questions[Math.floor(Math.random() * questions.length)];
          
          gameState.currentCall = {
            type: callType,
            question: question,
            startTime: Date.now()
          };
          
          // Ativar botões de atendimento
          document.getElementById('answerPhoneBtn').disabled = callType !== 'phone';
          document.getElementById('answerComputerBtn').disabled = callType !== 'computer';
          document.getElementById('transferBtn').disabled = false;
          document.getElementById('sendToDevBtn').disabled = question.type !== 'system';
          
          // Tocar som de chamada
          document.getElementById('ringSound').play();
          
          // Adicionar ao log
          addToLog(`Nova chamada ${callType === 'phone' ? 'telefônica' : 'via computador'} recebida.`);
          
          // Iniciar temporizador para chamada não atendida
          setTimeout(() => {
            if (gameState.currentCall) {
              addToLog("Chamada perdida por tempo de resposta. -20 pontos");
              gameState.player.points -= 20;
              gameState.moral -= 5;
              gameState.currentCall = null;
              document.getElementById('answerPhoneBtn').disabled = true;
              document.getElementById('answerComputerBtn').disabled = true;
              document.getElementById('transferBtn').disabled = true;
              document.getElementById('sendToDevBtn').disabled = true;
              updateHUD();
            }
          }, answerResponseDeadline / gameState.gameSpeed);
        }
        
        // Gerar próxima chamada
        generateCall();
      }, nextCallDelay);
    }

    // Iniciar transferências de bots para o jogador
    function startBotTransfers() {
      setInterval(() => {
        if (!gameState.running || gameState.currentCall || gameState.lunchActive || Math.random() < 0.7) return;
        
        // Bots ocasionalmente transferem chamadas para o jogador
        const busyAnalysts = gameState.analysts.filter(a => a.busy && a.currentTask);
        if (busyAnalysts.length > 0) {
          const randomAnalyst = busyAnalysts[Math.floor(Math.random() * busyAnalysts.length)];
          addToLog(`📞 ${randomAnalyst.name} transferiu uma chamada para você!`);
          
          // Criar chamada para o jogador
          gameState.currentCall = {
            type: randomAnalyst.currentTask.callType,
            question: randomAnalyst.currentTask.question,
            startTime: Date.now()
          };
          
          // Liberar o analista
          randomAnalyst.busy = false;
          randomAnalyst.currentTask = null;
          
          // Ativar botões de atendimento
          document.getElementById('answerPhoneBtn').disabled = gameState.currentCall.type !== 'phone';
          document.getElementById('answerComputerBtn').disabled = gameState.currentCall.type !== 'computer';
          document.getElementById('transferBtn').disabled = false;
          document.getElementById('sendToDevBtn').disabled = gameState.currentCall.question.type !== 'system';
          
          // Tocar som de chamada
          document.getElementById('ringSound').play();
        }
      }, 20000 / gameState.gameSpeed);
    }

    // Iniciar sistema de fofoca
    function startGossipSystem() {
      setInterval(() => {
        if (!gameState.running || gameState.gossipComplaintActive || gameState.lunchActive || Math.random() < 0.9) return;
        
        // Bots fazem fofoca sobre o jogador
        const gossipMessages = [
          "está chegando atrasado frequentemente",
          "não está atendendo as chamadas adequadamente",
          "está transferindo muitas chamadas",
          "está conversando demais durante o trabalho",
          "não está seguindo os procedimentos corretos"
        ];
        
        const randomMessage = gossipMessages[Math.floor(Math.random() * gossipMessages.length)];
        const randomAnalyst = gameState.analysts[Math.floor(Math.random() * gameState.analysts.length)];
        
        addToLog(`⚠️ ${randomAnalyst.name} reclamou na gerência que você ${randomMessage}`);
        
        // Mostrar modal de atenção da gerência após um tempo
        setTimeout(() => {
          if (gameState.running && !gameState.gossipComplaintActive && !gameState.lunchActive) {
            showGossipComplaint(randomAnalyst.name, randomMessage);
          }
        }, 5000 / gameState.gameSpeed);
      }, 45000 / gameState.gameSpeed);
    }

    // Mostrar reclamação por fofoca
    function showGossipComplaint(analystName, complaint) {
      gameState.gossipComplaintActive = true;
      document.getElementById('gossipMessage').textContent = 
        `${analystName} relatou que você ${complaint}. Precisamos conversar sobre isso.`;
      document.getElementById('gossipModal').style.display = 'flex';
      
      // Pausar atendimento de chamadas durante a reclamação
      if (gameState.currentCall) {
        document.getElementById('questionModal').style.display = 'none';
      }
      document.getElementById('answerPhoneBtn').disabled = true;
      document.getElementById('answerComputerBtn').disabled = true;
    }

    // Lidar com reclamação por fofoca
    function handleGossipComplaint(explained) {
      document.getElementById('gossipModal').style.display = 'none';
      gameState.gossipComplaintActive = false;
      
      if (explained) {
        addToLog("Você explicou a situação para o gerente. Moral levemente afetada.");
        gameState.moral = Math.max(0, gameState.moral - 5);
      } else {
        addToLog("Você ignorou a reclamação. Moral significativamente afetada.");
        gameState.moral = Math.max(0, gameState.moral - 15);
      }
      
      // Reativar botões de atendimento se havia uma chamada
      if (gameState.currentCall) {
        document.getElementById('answerPhoneBtn').disabled = gameState.currentCall.type !== 'phone';
        document.getElementById('answerComputerBtn').disabled = gameState.currentCall.type !== 'computer';
      }
      
      updateHUD();
    }

    // Atender chamada telefônica
    function answerPhoneCall() {
      if (!gameState.currentCall || gameState.currentCall.type !== 'phone') return;
      
      // Atualizar contador de atendimentos
      gameState.callPerformance.attended++;
      
      // Parar som de chamada
      document.getElementById('ringSound').pause();
      document.getElementById('ringSound').currentTime = 0;
      
      // Configurar modal com fundo de telefone
      document.getElementById('questionModal').className = 'modal phone-background';
      showQuestionModal();
    }

    // Atender chamada de computador
    function answerComputerCall() {
      if (!gameState.currentCall || gameState.currentCall.type !== 'computer') return;
      
      // Atualizar contador de atendimentos
      gameState.callPerformance.attended++;
      
      // Parar som de chamada
      document.getElementById('ringSound').pause();
      document.getElementById('ringSound').currentTime = 0;
      
      // Configurar modal com fundo de chat
      document.getElementById('questionModal').className = 'modal chat-background';
      showQuestionModal();
    }

    // Mostrar modal de pergunta
    function showQuestionModal() {
      const call = gameState.currentCall;
      if (!call) return;
      
      document.getElementById('callerType').textContent = 
        call.type === 'phone' ? '📞 Chamada Telefônica' : '💻 Chat de Computador';
      
      document.getElementById('modalQuestion').textContent = call.question.q;
      
      // Criar opções de resposta
      const optionsContainer = document.getElementById('modalOptions');
      optionsContainer.innerHTML = '';
      
      // Embaralhar opções
      const options = [
        { text: call.question.correct, type: 'correct' },
        { text: call.question.neutral, type: 'neutral' },
        { text: call.question.wrong, type: 'wrong' }
      ].sort(() => Math.random() - 0.5);
      
      options.forEach(option => {
        const optElement = document.createElement('div');
        optElement.className = 'opt';
        optElement.textContent = option.text;
        optElement.onclick = () => answerQuestion(option.type);
        optionsContainer.appendChild(optElement);
      });
      
      // Mostrar modal
      document.getElementById('questionModal').style.display = 'flex';
      
      // Desabilitar botões de atendimento
      document.getElementById('answerPhoneBtn').disabled = true;
      document.getElementById('answerComputerBtn').disabled = true;
    }

    // Responder pergunta
    function answerQuestion(answerType) {
      const call = gameState.currentCall;
      if (!call) return;
      
      // Esconder modal
      document.getElementById('questionModal').style.display = 'none';
      
      // Calcular pontos
      let points = 0;
      let ratingText = '';
      
      if (answerType === 'correct') {
        points = 100;
        ratingText = 'Resposta correta! Cliente satisfeito.';
        document.getElementById('correctSound').play();
        gameState.player.correctAnswers++;
      } else if (answerType === 'neutral') {
        points = 50;
        ratingText = 'Resposta neutra. Cliente indiferente.';
      } else {
        points = 0;
        ratingText = 'Resposta incorreta. Cliente insatisfeito.';
        document.getElementById('wrongSound').play();
      }
      
      // Atualizar estado do jogo
      gameState.player.points += points;
      gameState.player.callsAttended++;
      gameState.calls.answered++;
      gameState.dailyCalls++;
      
      // Atualizar última avaliação
      gameState.lastRating = {
        text: ratingText,
        type: answerType
      };
      
      // Mostrar avaliação
      const ratingElement = document.getElementById('lastCallRating');
      const ratingTextElement = document.getElementById('ratingText');
      
      ratingTextElement.textContent = ratingText;
      ratingTextElement.className = `rating-${answerType}`;
      ratingElement.style.display = 'block';
      
      // Adicionar ao log
      addToLog(`Chamada atendida: ${ratingText} (+${points} pontos)`);
      
      // Verificar conquistas
      checkAchievements();
      
      // Resetar chamada atual
      gameState.currentCall = null;
      
      // Atualizar interface
      updateHUD();
      updateGoalDisplay();
      
      // Desabilitar botões de transferência
      document.getElementById('transferBtn').disabled = true;
      document.getElementById('sendToDevBtn').disabled = true;
      
      // Voltar para a tela padrão após um tempo
      setTimeout(() => {
        document.getElementById('lastCallRating').style.display = 'none';
      }, 5000);
    }

    // Transferir chamada - CORREÇÃO 3: Adicionar barra de progresso
    function transferCall() {
      if (!gameState.currentCall) return;
      
      // Atualizar contador de transferências
      gameState.callPerformance.transferred++;
      
      // Encontrar analista disponível
      const availableAnalysts = gameState.analysts.filter(analyst => !analyst.busy);
      
      if (availableAnalysts.length > 0) {
        const randomAnalyst = availableAnalysts[Math.floor(Math.random() * availableAnalysts.length)];
        randomAnalyst.busy = true;
        
        // Verificar se é pergunta de sistema (vai para desenvolvimento depois)
        const isSystemQuestion = gameState.currentCall.question.type === 'system';
        
        randomAnalyst.currentTask = {
          type: 'call',
          question: gameState.currentCall.question,
          callType: gameState.currentCall.type,
          isSystemQuestion: isSystemQuestion,
          startTime: Date.now()
        };
        
        // CORREÇÃO 3: Adicionar barra de progresso visual
        const deskElement = document.getElementById(randomAnalyst.id);
        const progressBar = document.createElement('div');
        progressBar.className = 'analyst-progress-bar';
        const progressFill = document.createElement('div');
        progressFill.className = 'analyst-progress-fill';
        progressFill.style.width = '0%';
        progressBar.appendChild(progressFill);
        deskElement.appendChild(progressBar);
        
        // Registrar transferência
        const transferId = Date.now();
        gameState.transferredCalls.set(transferId, {
          analyst: randomAnalyst.name,
          question: gameState.currentCall.question.q,
          startTime: Date.now(),
          toDev: isSystemQuestion,
          progressElement: progressFill,
          progressBar: progressBar
        });
        
        addToLog(`📞 Chamada transferida para ${randomAnalyst.name}${isSystemQuestion ? ' (será encaminhada para desenvolvimento)' : ''}`);
        
        // CORREÇÃO 3: Iniciar progresso da chamada
        startAnalystCallProgress(randomAnalyst, transferId);
        
        // Esconder modal se estiver aberto
        document.getElementById('questionModal').style.display = 'none';
        
        // Atualizar estatísticas
        gameState.player.transfers++;
        gameState.player.points += 25; // Pontos por transferência
        
        // Resetar chamada atual
        gameState.currentCall = null;
        
        // Atualizar interface
        updateHUD();
        
        // Desabilitar botões
        document.getElementById('answerPhoneBtn').disabled = true;
        document.getElementById('answerComputerBtn').disabled = true;
        document.getElementById('transferBtn').disabled = true;
        document.getElementById('sendToDevBtn').disabled = true;
        
        // Verificar conquistas
        checkAchievements();
      } else {
        addToLog("Nenhum analista disponível para transferência.");
      }
    }

    // CORREÇÃO 3: Iniciar progresso da chamada do analista
    function startAnalystCallProgress(analyst, transferId) {
      const transferRecord = gameState.transferredCalls.get(transferId);
      if (!transferRecord) return;
      
      const duration = transferRecord.toDev ? 5000 : 15000; // 5 segundos para dev, 15 para normal
      
      analyst.progressInterval = setInterval(() => {
        if (!analyst.busy || !analyst.currentTask) {
          clearInterval(analyst.progressInterval);
          if (transferRecord.progressBar) {
            transferRecord.progressBar.remove();
          }
          return;
        }
        
        const elapsed = Date.now() - analyst.currentTask.startTime;
        const progress = Math.min(100, (elapsed / duration) * 100);
        
        if (transferRecord.progressElement) {
          transferRecord.progressElement.style.width = `${progress}%`;
        }
        
        if (progress >= 100) {
          clearInterval(analyst.progressInterval);
          
          if (transferRecord.toDev) {
            // CORREÇÃO 3: Transferir para desenvolvimento após 5 segundos
            transferToDevelopment(analyst, transferId);
          } else {
            // Chamada normal resolvida
            resolveAnalystCall(analyst, transferId);
          }
        }
      }, 1000 / gameState.gameSpeed);
    }

    // CORREÇÃO 3: Transferir para desenvolvimento após 5 segundos
    function transferToDevelopment(analyst, transferId) {
      if (!analyst.busy || !analyst.currentTask) return;
      
      // Encontrar desenvolvedor disponível
      const availableDevs = gameState.developers.filter(dev => !dev.busy);
      
      if (availableDevs.length > 0) {
        const randomDev = availableDevs[Math.floor(Math.random() * availableDevs.length)];
        const task = devTasks[Math.floor(Math.random() * devTasks.length)];
        
        randomDev.busy = true;
        randomDev.currentTask = {
          type: 'dev',
          name: task.name,
          points: task.points,
          duration: task.duration,
          startTime: Date.now(),
          progress: 0
        };
        
        // Atualizar registro de transferência
        const transferRecord = gameState.transferredCalls.get(transferId);
        if (transferRecord) {
          transferRecord.dev = randomDev.name;
          transferRecord.devStartTime = Date.now();
          // Remover barra de progresso do analista
          if (transferRecord.progressBar) {
            transferRecord.progressBar.remove();
          }
        }
        
        addToLog(`⚙️ ${analyst.name} encaminhou a chamada para ${randomDev.name} (${task.name})`);
        
        // CORREÇÃO 3: O próprio analista irá entregar a tarefa quando pronta
        startDevProgressWithAutoDelivery(randomDev, transferId, analyst);
        
        // Liberar analista
        analyst.busy = false;
        analyst.currentTask = null;
      } else {
        addToLog(`❌ ${analyst.name} tentou encaminhar para desenvolvimento, mas não há desenvolvedores disponíveis.`);
        // Liberar analista se não há devs disponíveis
        analyst.busy = false;
        analyst.currentTask = null;
        const transferRecord = gameState.transferredCalls.get(transferId);
        if (transferRecord && transferRecord.progressBar) {
          transferRecord.progressBar.remove();
        }
      }
    }

    // CORREÇÃO 3: Iniciar progresso com entrega automática
    function startDevProgressWithAutoDelivery(dev, transferId, originalAnalyst) {
      // Adicionar barra de progresso visual
      const deskElement = document.getElementById(dev.id);
      const progressBar = document.createElement('div');
      progressBar.className = 'dev-progress-bar';
      const progressFill = document.createElement('div');
      progressFill.className = 'dev-progress-fill';
      progressFill.style.width = '0%';
      progressBar.appendChild(progressFill);
      deskElement.appendChild(progressBar);
      
      dev.progressInterval = setInterval(() => {
        if (!dev.busy || !dev.currentTask) {
          clearInterval(dev.progressInterval);
          progressBar.remove();
          return;
        }
        
        const elapsed = Date.now() - dev.currentTask.startTime;
        const progress = Math.min(100, (elapsed / dev.currentTask.duration) * 100);
        
        dev.currentTask.progress = progress;
        progressFill.style.width = `${progress}%`;
        
        if (progress >= 100) {
          clearInterval(dev.progressInterval);
          dev.currentTask.completed = true;
          
          // CORREÇÃO 3: Entrega automática pela equipe
          autoDeliverDevTask(dev, transferId, originalAnalyst);
        }
      }, 1000 / gameState.gameSpeed);
    }

    // CORREÇÃO 3: Entrega automática da tarefa
    function autoDeliverDevTask(dev, transferId, originalAnalyst) {
      const transferRecord = gameState.transferredCalls.get(transferId);
      if (!transferRecord) return;
      
      // Remover barra de progresso
      const deskElement = document.getElementById(dev.id);
      const progressBar = deskElement.querySelector('.dev-progress-bar');
      if (progressBar) progressBar.remove();
      
      // Adicionar pontos automaticamente
      const taskPoints = dev.currentTask.points;
      gameState.player.points += taskPoints;
      
      addToLog(`✅ ${originalAnalyst.name} entregou a tarefa "${dev.currentTask.name}" ao cliente! +${taskPoints} pontos`);
      
      // Liberar desenvolvedor
      dev.busy = false;
      dev.currentTask = null;
      
      updateHUD();
    }

    // Resolver chamada do analista
    function resolveAnalystCall(analyst, transferId) {
      if (!analyst.currentTask) return;
      
      // Remover barra de progresso
      const transferRecord = gameState.transferredCalls.get(transferId);
      if (transferRecord && transferRecord.progressBar) {
        transferRecord.progressBar.remove();
      }
      
      // Chance de acerto do analista
      const isCorrect = Math.random() < 0.7;
      const points = isCorrect ? 50 : 0;
      
      // Atualizar registro
      if (transferRecord) {
        transferRecord.resolved = true;
        transferRecord.success = isCorrect;
        transferRecord.endTime = Date.now();
        transferRecord.points = points;
      }
      
      // Adicionar pontos ao jogador
      gameState.player.points += points;
      
      analyst.busy = false;
      analyst.currentTask = null;
      
      addToLog(`${analyst.name} ${isCorrect ? 'resolveu' : 'não resolveu'} a chamada transferida. ${points > 0 ? `+${points} pontos` : ''}`);
      updateHUD();
    }

    // Enviar para desenvolvimento
    function sendToDevelopment() {
      if (!gameState.currentCall) return;
      
      // Verificar se é um erro de sistema
      if (gameState.currentCall.question.type !== 'system') {
        // Mostrar advertência da gerência
        addToLog("⚠️ ADVERTÊNCIA DA GERÊNCIA: Você enviou uma tarefa simples para desenvolvimento! -10 pontos");
        gameState.player.points -= 10;
        gameState.moral -= 5;
        
        // Atualizar interface
        updateHUD();
        
        // Esconder modal
        document.getElementById('questionModal').style.display = 'none';
        
        // Resetar chamada atual
        gameState.currentCall = null;
        
        // Desabilitar botões
        document.getElementById('answerPhoneBtn').disabled = true;
        document.getElementById('answerComputerBtn').disabled = true;
        document.getElementById('transferBtn').disabled = true;
        document.getElementById('sendToDevBtn').disabled = true;
        
        return;
      }
      
      // Encontrar desenvolvedor disponível
      const availableDevs = gameState.developers.filter(dev => !dev.busy);
      
      if (availableDevs.length > 0) {
        const randomDev = availableDevs[Math.floor(Math.random() * availableDevs.length)];
        const task = devTasks[Math.floor(Math.random() * devTasks.length)];
        
        randomDev.busy = true;
        randomDev.currentTask = {
          type: 'dev',
          name: task.name,
          points: task.points,
          duration: task.duration,
          startTime: Date.now(),
          progress: 0
        };
        
        // Registrar tarefa pendente
        const taskId = Date.now();
        gameState.pendingDevTasks.push({
          id: taskId,
          dev: randomDev.name,
          task: task.name,
          points: task.points,
          startTime: Date.now()
        });
        
        // Iniciar progresso da tarefa
        startDevProgress(randomDev, taskId);
        
        // Esconder modal
        document.getElementById('questionModal').style.display = 'none';
        
        // Adicionar ao log
        addToLog(`⚙️ Tarefa "${task.name}" enviada para ${randomDev.name}. Barra de progresso iniciada.`);
        
        // Atualizar estatísticas
        gameState.player.devTasks++;
        gameState.player.points += 75; // Pontos por envio para desenvolvimento
        
        // Resetar chamada atual
        gameState.currentCall = null;
        
        // Atualizar interface
        updateHUD();
        
        // Desabilitar botões
        document.getElementById('answerPhoneBtn').disabled = true;
        document.getElementById('answerComputerBtn').disabled = true;
        document.getElementById('transferBtn').disabled = true;
        document.getElementById('sendToDevBtn').disabled = true;
        
        // Verificar conquistas
        checkAchievements();
      } else {
        addToLog("Nenhum desenvolvedor disponível no momento.");
      }
    }

    // Iniciar progresso de desenvolvimento
    function startDevProgress(dev, taskId) {
      // Adicionar barra de progresso visual
      const deskElement = document.getElementById(dev.id);
      const progressBar = document.createElement('div');
      progressBar.className = 'dev-progress-bar';
      const progressFill = document.createElement('div');
      progressFill.className = 'dev-progress-fill';
      progressFill.style.width = '0%';
      progressBar.appendChild(progressFill);
      deskElement.appendChild(progressBar);
      
      dev.progressInterval = setInterval(() => {
        if (!dev.busy || !dev.currentTask) {
          clearInterval(dev.progressInterval);
          progressBar.remove();
          return;
        }
        
        const elapsed = Date.now() - dev.currentTask.startTime;
        const progress = Math.min(100, (elapsed / dev.currentTask.duration) * 100);
        
        dev.currentTask.progress = progress;
        progressFill.style.width = `${progress}%`;
        
        if (progress >= 100) {
          clearInterval(dev.progressInterval);
          dev.currentTask.completed = true;
          
          // Mostrar modal para entrega
          showDevDeliveryModal(dev, taskId);
        }
      }, 1000 / gameState.gameSpeed);
    }

    // Mostrar modal de entrega de tarefa
    function showDevDeliveryModal(dev, taskId) {
      const task = gameState.pendingDevTasks.find(t => t.id === taskId);
      if (!task) return;
      
      document.getElementById('devDeliveryMessage').textContent = 
        `A tarefa "${task.task}" de ${dev.name} está pronta! Clique para entregar ao cliente e receber ${task.points} pontos.`;
      
      // Armazenar referências para uso no callback
      document.getElementById('devDeliveryModal').currentDev = dev;
      document.getElementById('devDeliveryModal').currentTaskId = taskId;
      
      document.getElementById('devDeliveryModal').style.display = 'flex';
      
      // Se o jogador demorar muito, gerência chama atenção
      setTimeout(() => {
        if (document.getElementById('devDeliveryModal').style.display === 'flex') {
          addToLog("⚠️ ATENÇÃO: Você está demorando para entregar a tarefa concluída! -10 pontos");
          gameState.player.points -= 10;
          updateHUD();
        }
      }, 30000 / gameState.gameSpeed);
    }

    // Entregar tarefa de desenvolvimento
    function deliverDevTask() {
      const modal = document.getElementById('devDeliveryModal');
      const dev = modal.currentDev;
      const taskId = modal.currentTaskId;
      
      modal.style.display = 'none';
      
      const taskIndex = gameState.pendingDevTasks.findIndex(t => t.id === taskId);
      if (taskIndex !== -1) {
        const task = gameState.pendingDevTasks[taskIndex];
        
        // Adicionar pontos
        gameState.player.points += task.points;
        addToLog(`✅ Tarefa "${task.task}" entregue ao cliente! +${task.points} pontos`);
        
        // Remover da lista de pendentes
        gameState.pendingDevTasks.splice(taskIndex, 1);
        
        // Liberar desenvolvedor
        dev.busy = false;
        dev.currentTask = null;
        
        // Remover barra de progresso
        const deskElement = document.getElementById(dev.id);
        const progressBar = deskElement.querySelector('.dev-progress-bar');
        if (progressBar) progressBar.remove();
        
        updateHUD();
      }
    }

    // Pressão no desenvolvedor
    function pressureDeveloper(devId) {
      const dev = gameState.developers.find(d => d.id === devId);
      if (!dev || !dev.busy || !dev.currentTask) {
        addToLog("❌ Este desenvolvedor não está trabalhando em nenhuma tarefa no momento.");
        return;
      }
      
      if (dev.currentTask.progress < 50) {
        // Desenvolvedor xinga e reclama na gerência
        addToLog(`😠 ${dev.name}: "Estou trabalhando! Pare de me pressionar!"`);
        addToLog(`⚠️ ${dev.name} reclamou de você na gerência. Moral diminuída.`);
        gameState.moral = Math.max(0, gameState.moral - 10);
        
        // Chance de gerência chamar atenção
        if (Math.random() < 0.5) {
          setTimeout(() => {
            showGossipComplaint(dev.name, "está pressionando a equipe de desenvolvimento desnecessariamente");
          }, 3000 / gameState.gameSpeed);
        }
      } else {
        // Acelera o progresso
        const acceleration = 0.3; // 30% de aceleração
        dev.currentTask.startTime -= dev.currentTask.duration * acceleration;
        addToLog(`⚡ Você pressionou ${dev.name}. Progresso acelerado em 30%!`);
      }
      
      updateHUD();
    }

    // Mostrar modal do gerente
    function showManagerModal() {
      gameState.managerEventShown = true;
      document.getElementById('managerModal').style.display = 'flex';
    }

    // Lidar com pedido do gerente
    function handleManagerRequest(accepted) {
      document.getElementById('managerModal').style.display = 'none';
      
      if (accepted) {
        // Aceitar hora extra - continuar jogando até 19:00
        addToLog("⏰ Você aceitou fazer hora extra. Continue trabalhando até 19:00!");
        gameState.player.overtimeAccepted++;
        gameState.player.points += 100;
        
        // Verificar conquista
        if (gameState.player.overtimeAccepted >= 3) {
          const overtimeAchievement = achievements.find(a => a.id === 'overtime_king');
          if (overtimeAchievement && !overtimeAchievement.unlocked) {
            overtimeAchievement.unlocked = true;
            addToLog("🏆 Conquista desbloqueada: Rei da Hora Extra!");
            updateAchievements();
          }
        }
      } else {
        // Recusar hora extra - terminar o dia
        addToLog("Você recusou a hora extra. Finalizando expediente...");
        endDay();
      }
      
      // Atualizar interface
      updateHUD();
    }

    // Mostrar modal de ajuda do analista
    function showAnalystHelpModal() {
      if (gameState.analystHelpActive || gameState.currentCall || gameState.lunchActive) return;
      
      gameState.analystHelpActive = true;
      
      // Selecionar analista aleatório
      const randomAnalyst = gameState.analysts[Math.floor(Math.random() * gameState.analysts.length)];
      
      // Atualizar modal com informações do analista
      document.getElementById('analystHelpName').textContent = randomAnalyst.name;
      document.getElementById('analystHelpBadge').textContent = `Analista`;
      document.getElementById('analystHelpMessage').textContent = 
        "Preciso de ajuda com um problema complexo de sistema!";
      
      // Armazenar analista que está pedindo ajuda
      gameState.currentAnalystHelp = randomAnalyst;
      
      // Mostrar modal
      document.getElementById('analystHelpModal').style.display = 'flex';
    }

    // Lidar com pedido de ajuda do analista
    function handleAnalystHelp(helped) {
      document.getElementById('analystHelpModal').style.display = 'none';
      gameState.analystHelpActive = false;
      
      if (helped && gameState.currentAnalystHelp) {
        // Mostrar modal com a pergunta do analista
        showAnalystQuestionModal(gameState.currentAnalystHelp);
      } else {
        addToLog("Você ignorou o pedido de ajuda do analista. Moral diminuída.");
        gameState.moral = Math.max(0, gameState.moral - 10);
        gameState.currentAnalystHelp = null;
        updateHUD();
      }
    }

    // Mostrar modal com pergunta do analista
    function showAnalystQuestionModal(analyst) {
      // Selecionar pergunta complexa (sistema)
      const systemQuestions = questions.filter(q => q.type === 'system');
      const question = systemQuestions[Math.floor(Math.random() * systemQuestions.length)];
      
      document.getElementById('helpingAnalystName').textContent = analyst.name;
      document.getElementById('analystModalQuestion').textContent = question.q;
      
      // Criar opções de resposta
      const optionsContainer = document.getElementById('analystModalOptions');
      optionsContainer.innerHTML = '';
      
      // Embaralhar opções
      const options = [
        { text: question.correct, type: 'correct' },
        { text: question.neutral, type: 'neutral' },
        { text: question.wrong, type: 'wrong' }
      ].sort(() => Math.random() - 0.5);
      
      options.forEach(option => {
        const optElement = document.createElement('div');
        optElement.className = 'opt';
        optElement.textContent = option.text;
        optElement.onclick = () => answerAnalystQuestion(option.type, analyst);
        optionsContainer.appendChild(optElement);
      });
      
      // Mostrar modal
      document.getElementById('analystQuestionModal').style.display = 'flex';
    }

    // Responder pergunta do analista
    function answerAnalystQuestion(answerType, analyst) {
      document.getElementById('analystQuestionModal').style.display = 'none';
      
      let points = 0;
      let message = "";
      
      if (answerType === 'correct') {
        points = 75;
        message = "Você ajudou o analista com um problema complexo!";
        document.getElementById('correctSound').play();
      } else if (answerType === 'neutral') {
        points = 25;
        message = "Você deu uma ajuda razoável ao analista.";
      } else {
        points = 0;
        message = "Sua ajuda não foi muito eficiente para o analista.";
        document.getElementById('wrongSound').play();
      }
      
      // Atualizar estado do jogo
      gameState.player.points += points;
      gameState.moral = Math.min(100, gameState.moral + 15);
      
      // Adicionar ao log
      addToLog(`${message} +${points} pontos`);
      
      // Resetar
      gameState.currentAnalystHelp = null;
      
      // Atualizar interface
      updateHUD();
    }

    // Mostrar modal para selecionar analista para conversa
    function showAnalystSelectModal() {
      if (gameState.conversationActive || gameState.currentCall || gameState.lunchActive) return;
      
      gameState.conversationActive = true;
      
      const analystList = document.getElementById('analystList');
      analystList.innerHTML = '';
      
      // Adicionar analistas disponíveis
      gameState.analysts.forEach(analyst => {
        const analystItem = document.createElement('div');
        analystItem.className = 'analyst-item';
        analystItem.innerHTML = `
          <div>👨‍💻</div>
          <div>${analyst.name}</div>
        `;
        analystItem.onclick = () => startConversation(analyst);
        analystList.appendChild(analystItem);
      });
      
      // Mostrar modal
      document.getElementById('analystSelectModal').style.display = 'flex';
    }

    // Iniciar conversa com analista
    function startConversation(analyst) {
      document.getElementById('analystSelectModal').style.display = 'none';
      
      // Atualizar modal de conversa
      document.getElementById('conversationAnalystName').textContent = analyst.name;
      document.getElementById('conversationAnalystBadge').textContent = 'Analista';
      document.getElementById('conversationMessage').textContent = 
        "E aí, tudo bem? Quer bater um papo?";
      
      // Mostrar modal de conversa
      document.getElementById('conversationModal').style.display = 'flex';
    }

    // Lidar com conversa com analista
    function handleConversation(talked) {
      document.getElementById('conversationModal').style.display = 'none';
      gameState.conversationActive = false;
      
      if (talked) {
        addToLog("Você conversou com o analista. Moral aumentada!");
        gameState.moral = Math.min(100, gameState.moral + 10);
      } else {
        addToLog("Você ignorou o analista. Moral diminuída.");
        gameState.moral = Math.max(0, gameState.moral - 5);
      }
      
      // Atualizar interface
      updateHUD();
    }

    // Mostrar modal para reclamar de analista
    function showComplaintModal() {
      const complaintList = document.getElementById('complaintList');
      complaintList.innerHTML = '';
      
      // Adicionar analistas para reclamar
      gameState.analysts.forEach(analyst => {
        const complaintItem = document.createElement('div');
        complaintItem.className = 'complaint-item';
        complaintItem.innerHTML = `
          <div>👨‍💻</div>
          <div>${analyst.name}</div>
        `;
        complaintItem.onclick = () => makeComplaint(analyst);
        complaintList.appendChild(complaintItem);
      });
      
      // Mostrar modal
      document.getElementById('complaintModal').style.display = 'flex';
    }

    // Fazer reclamação sobre analista
    function makeComplaint(analyst) {
      document.getElementById('complaintModal').style.display = 'none';
      
      addToLog(`⚠️ Você reclamou sobre ${analyst.name} para a gerência. Moral diminuída.`);
      gameState.moral = Math.max(0, gameState.moral - 15);
      
      // Chance do analista retaliar com fofoca
      if (Math.random() < 0.7) {
        setTimeout(() => {
          showGossipComplaint(analyst.name, "fez uma reclamação falsa sobre mim");
        }, 10000 / gameState.gameSpeed);
      }
      
      updateHUD();
    }

    // Finalizar dia
    function endDay() {
      pauseGame();
      
      // Resetar contadores de desempenho
      gameState.callPerformance.attended = 0;
      gameState.callPerformance.transferred = 0;
      gameState.elapsedSimMinutes = 0; // Resetar tempo decorrido
      
      // Verificar se atingiu a meta
      const goalReached = gameState.calls.answered >= gameState.calls.goal;
      
      // Calcular bônus por meta
      let bonusPoints = 0;
      if (goalReached) {
        bonusPoints = 200;
        addToLog(`🏆 Meta diária atingida! Bônus de ${bonusPoints} pontos.`);
      } else {
        addToLog(`Meta diária não atingida: ${gameState.calls.answered}/${gameState.calls.goal} chamadas.`);
      }
      
      gameState.player.points += bonusPoints;
      
      // Verificar se é o último dia
      if (gameState.day >= daysTotal) {
        endGame();
        return;
      }
      
      // Preparar próximo dia
      gameState.day++;
      gameState.time = "08:00";
      gameState.calls.answered = 0;
      gameState.calls.goal = 5 + (gameState.day - 1) * 2; // Aumenta gradativamente
      gameState.lunchSelected = false;
      gameState.lunchActive = false;
      gameState.managerEventShown = false;
      gameState.dailyCalls = 0;
      
      // Atualizar interface
      updateHUD();
      updateGoalDisplay();
      
      // Mostrar resumo do dia
      setTimeout(() => {
        alert(`Dia ${gameState.day-1} concluído!\nChamadas atendidas: ${gameState.dailyCalls}\nPontos ganhos: ${bonusPoints > 0 ? bonusPoints + ' (bônus incluído)' : '0'}\n\nPróximo dia iniciando...`);
        startGame();
      }, 1000);
    }

    // Finalizar jogo
    function endGame() {
      pauseGame();
      
      // Calcular pontuação final
      const finalScore = gameState.player.points;
      let rank = "Estagiário";
      
      if (finalScore >= 2000) rank = "Analista Sênior";
      else if (finalScore >= 1500) rank = "Analista Pleno";
      else if (finalScore >= 1000) rank = "Analista Júnior";
      else if (finalScore >= 500) rank = "Assistente";
      
      // Mostrar tela de fim de jogo
      setTimeout(() => {
        alert(`Jogo Concluído!\n\nPontuação Final: ${finalScore}\nRank: ${rank}\n\nObrigado por jogar Suporte Simulator!`);
      }, 1000);
    }

    // Adicionar entrada ao log
    function addToLog(message) {
      const logElement = document.getElementById('log');
      const entry = document.createElement('div');
      entry.textContent = `[${gameState.time}] ${message}`;
      logElement.appendChild(entry);
      logElement.scrollTop = logElement.scrollHeight;
    }

    // Atualizar conquistas
    function updateAchievements() {
      const achievementList = document.getElementById('achievementList');
      achievementList.innerHTML = '';
      
      achievements.forEach(achievement => {
        const achievementElement = document.createElement('div');
        achievementElement.className = `achievement ${achievement.unlocked ? 'unlocked' : 'locked'}`;
        
        achievementElement.innerHTML = `
          <div class="achievement-icon">${achievement.unlocked ? '🏆' : '🔒'}</div>
          <div>
            <div><strong>${achievement.name}</strong></div>
            <div>${achievement.description}</div>
          </div>
        `;
        
        achievementList.appendChild(achievementElement);
      });
    }

    // Verificar conquistas
    function checkAchievements() {
      // Primeira chamada
      if (gameState.player.callsAttended >= 1) {
        unlockAchievement('first_call');
      }
      
      // 5 chamadas em um dia
      if (gameState.dailyCalls >= 5) {
        unlockAchievement('five_calls');
      }
      
      // Mestre do desenvolvimento
      if (gameState.player.devTasks >= 5) {
        unlockAchievement('dev_master');
      }
      
      // Profissional de transferência
      if (gameState.player.transfers >= 10) {
        unlockAchievement('transfer_pro');
      }
    }

    // Desbloquear conquista
    function unlockAchievement(achievementId) {
      const achievement = achievements.find(a => a.id === achievementId);
      if (achievement && !achievement.unlocked) {
        achievement.unlocked = true;
        addToLog(`🏆 Conquista desbloqueada: ${achievement.name}!`);
        updateAchievements();
      }
    }

    // Inicializar quando a página carregar
    window.addEventListener('DOMContentLoaded', () => {
      // Mostrar modal de entrada de nomes
      document.getElementById('nameInputModal').style.display = 'flex';
    });
  </script>
</body>
</html>
